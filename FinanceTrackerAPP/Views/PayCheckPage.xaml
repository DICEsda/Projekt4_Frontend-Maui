<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:FinanceTracker.ViewModels"
             x:Class="FinanceTracker.Views.PayCheckPage"
             BackgroundColor="#1E1E1E"
             x:DataType="vm:PayCheckViewModel"
             xmlns:services="clr-namespace:MyApp.Services"
             Title="{Binding [PaycheckTitle], Source={x:Static services:TranslationService.Instance}}">

    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="20">
            <!-- Result Section -->
            <Frame CornerRadius="8"
                   HasShadow="True"
                   BackgroundColor="{StaticResource CardBackground}"
                   Padding="15"
                   IsVisible="{Binding CompareResult, Converter={StaticResource StringNotNullOrEmptyConverter}}">
                <Label HorizontalOptions="Center" 
                       FontSize="18" 
                       Text="{Binding CompareResult}"
                       TextColor="{StaticResource TextPrimary}"/>
            </Frame>

            <!-- Header -->
            <Label Text="{Binding [PaycheckDetails], Source={x:Static services:TranslationService.Instance}}"
                   Style="{StaticResource TitleLabelStyle}"
                   FontSize="24"
                   Margin="0,0,0,10"/>

            <!-- Input Section -->
            <Frame CornerRadius="8"
                   HasShadow="True"
                   BackgroundColor="{StaticResource CardBackground}"
                   Padding="15">
                <Grid RowSpacing="15" ColumnSpacing="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Company Name -->
                    <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="5">
                        <Label Text="{Binding [CompanyNameLabel], Source={x:Static services:TranslationService.Instance}}"
                               Style="{StaticResource LabelStyle}"/>
                        <Border BackgroundColor="White"
                                Stroke="#ccc"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 8"
                                Padding="15,5">
                            <Entry x:Name="CompanyEntry"
                                   Placeholder="Novo Nordisk"
                                   Text="{Binding CompanyName}"
                                   Style="{StaticResource EntryStyle}"/>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Month -->
                    <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="5">
                        <Label Text="{Binding [PaycheckMonthLabel], Source={x:Static services:TranslationService.Instance}}"
                               Style="{StaticResource LabelStyle}"/>
                        <Border BackgroundColor="White"
                                Stroke="#ccc"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 8"
                                Padding="15,5">
                            <Entry x:Name="MonthEntry"
                                   Placeholder="e.g. 4"
                                   Keyboard="Numeric"
                                   Text="{Binding Month}"
                                   Style="{StaticResource EntryStyle}"/>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Generate Button -->
                    <Button Grid.Row="1" 
                            Grid.ColumnSpan="2"
                            Text="Generer lønestimation"
                            BackgroundColor="LightGreen"
                            TextColor="Black"
                            Command="{Binding SalaryEstimationForMonthCommand}"
                            HeightRequest="45"
                            CornerRadius="8"
                            Margin="0,10"/>

                    <!-- Results Grid -->
                    <Grid Grid.Row="2" 
                          Grid.ColumnSpan="2"
                          RowSpacing="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Style="{StaticResource ResultBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Text="Løn før skat:" Style="{StaticResource LabelStyle}"/>
                                <Label Text="{Binding SalaryBeforeTax}" Grid.Column="1" Style="{StaticResource ValueLabelStyle}"/>
                            </Grid>
                        </Border>

                        <Border Grid.Row="1" Style="{StaticResource ResultBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Text="Arbejdstimer:" Style="{StaticResource LabelStyle}"/>
                                <Label Text="{Binding WorkedHours}" Grid.Column="1" Style="{StaticResource ValueLabelStyle}"/>
                            </Grid>
                        </Border>

                        <Border Grid.Row="2" Style="{StaticResource ResultBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Text="AM-bidrag:" Style="{StaticResource LabelStyle}"/>
                                <Label Text="{Binding AmContribution}" Grid.Column="1" Style="{StaticResource ValueLabelStyle}"/>
                            </Grid>
                        </Border>

                        <Border Grid.Row="3" Style="{StaticResource ResultBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Text="Skat i %:" Style="{StaticResource LabelStyle}"/>
                                <Label Text="{Binding Tax}" Grid.Column="1" Style="{StaticResource ValueLabelStyle}"/>
                            </Grid>
                        </Border>

                        <Border Grid.Row="4" Style="{StaticResource ResultBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Text="Løn efter skat:" Style="{StaticResource LabelStyle}"/>
                                <Label Text="{Binding SalaryAfterTax}" Grid.Column="1" Style="{StaticResource ValueLabelStyle}"/>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </Frame>

            <!-- Actual Values Section -->
            <Frame CornerRadius="8"
                   HasShadow="True"
                   BackgroundColor="{StaticResource CardBackground}"
                   Padding="15">
                <Grid RowSpacing="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>

                    <!-- Actual Values -->
                    <Label Grid.Row="0" Grid.Column="0" Text="Løn før skat" Style="{StaticResource LabelStyle}"/>
                    <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource InputBorderStyle}">
                        <Entry Text="{Binding SalaryBeforeTaxActual}" Style="{StaticResource EntryStyle}"/>
                    </Border>
                    <BoxView Grid.Row="0" Grid.Column="2" BackgroundColor="{Binding SalaryBeforeTaxIndicator}" CornerRadius="4"/>

                    <Label Grid.Row="1" Grid.Column="0" Text="Arbejdstimer" Style="{StaticResource LabelStyle}"/>
                    <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource InputBorderStyle}">
                        <Entry Text="{Binding WorkedHoursActual}" Style="{StaticResource EntryStyle}"/>
                    </Border>
                    <BoxView Grid.Row="1" Grid.Column="2" BackgroundColor="{Binding WorkedHoursIndicator}" CornerRadius="4"/>

                    <Label Grid.Row="2" Grid.Column="0" Text="AM-bidrag" Style="{StaticResource LabelStyle}"/>
                    <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource InputBorderStyle}">
                        <Entry Text="{Binding AmContributionActual}" Style="{StaticResource EntryStyle}"/>
                    </Border>
                    <BoxView Grid.Row="2" Grid.Column="2" BackgroundColor="{Binding AmContributionIndicator}" CornerRadius="4"/>

                    <Label Grid.Row="3" Grid.Column="0" Text="Skat i %" Style="{StaticResource LabelStyle}"/>
                    <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource InputBorderStyle}">
                        <Entry Text="{Binding TaxActual}" Style="{StaticResource EntryStyle}"/>
                    </Border>
                    <BoxView Grid.Row="3" Grid.Column="2" BackgroundColor="{Binding TaxIndicator}" CornerRadius="4"/>

                    <Label Grid.Row="4" Grid.Column="0" Text="Løn efter skat" Style="{StaticResource LabelStyle}"/>
                    <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource InputBorderStyle}">
                        <Entry Text="{Binding SalaryAfterTaxActual}" Style="{StaticResource EntryStyle}"/>
                    </Border>
                    <BoxView Grid.Row="4" Grid.Column="2" BackgroundColor="{Binding SalaryAfterTaxIndicator}" CornerRadius="4"/>
                </Grid>
            </Frame>

            <!-- Action Buttons -->
            <VerticalStackLayout Spacing="10">
                <Button Text="{Binding [PaycheckCompareButton], Source={x:Static services:TranslationService.Instance}}"
                        Command="{Binding CompareCommand}"
                        BackgroundColor="#0078D7"
                        TextColor="White"
                        HeightRequest="45"
                        CornerRadius="8"/>

                <Button Text="Generate PDF"
                        Clicked="Button_OnClicked"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        HeightRequest="45"
                        CornerRadius="8"/>
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
